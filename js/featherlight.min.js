(function(n){"use strict";function t(n,i){if(this instanceof t)this.id=t.id++,this.setup(n,i),this.chainCallbacks(t._callbackChain);else{var r=new t(n,i);return r.open(),r}}function o(n,t){var r={};for(var i in n)i in t&&(r[i]=n[i],delete n[i]);return r}function s(n,t){var u={},e=new RegExp("^"+t+"([A-Z])(.*)"),r,i,f;for(r in n)i=r.match(e),i&&(f=(i[1]+i[2].replace(/([A-Z])/g,"-$1")).toLowerCase(),u[f]=n[r]);return u}var i,r,u;if("undefined"==typeof n){"console"in window&&window.console.info("Too much lightness, Featherlight needs jQuery.");return}i=[];r=function(t){return i=n.grep(i,function(n){return n!==t&&n.$instance.closest("body").length>0})};u={allowfullscreen:1,frameborder:1,height:1,longdesc:1,marginheight:1,marginwidth:1,name:1,referrerpolicy:1,scrolling:1,sandbox:1,src:1,srcdoc:1,width:1};var f={keyup:"onKeyUp",resize:"onResize"},h=function(i){n.each(t.opened().reverse(),function(){if(!i.isDefaultPrevented()&&!1===this[f[i.type]](i))return i.preventDefault(),i.stopPropagation(),!1})},e=function(i){if(i!==t._globalHandlerInstalled){t._globalHandlerInstalled=i;var r=n.map(f,function(n,i){return i+"."+t.prototype.namespace}).join(" ");n(window)[i?"on":"off"](r,h)}};t.prototype={constructor:t,namespace:"featherlight",targetAttr:"data-featherlight",variant:null,resetCss:!1,background:null,openTrigger:"click",closeTrigger:"click",filter:null,root:"body",openSpeed:250,closeSpeed:250,closeOnClick:"background",closeOnEsc:!0,closeIcon:"&#10005;",loading:"",persist:!1,otherClose:null,beforeOpen:n.noop,beforeContent:n.noop,beforeClose:n.noop,afterOpen:n.noop,afterContent:n.noop,afterClose:n.noop,onKeyUp:n.noop,onResize:n.noop,type:null,contentFilters:["jquery","image","html","ajax","iframe","text"],setup:function(t,i){typeof t!="object"||t instanceof n!=!1||i||(i=t,t=undefined);var r=n.extend(this,i,{target:t}),u=r.resetCss?r.namespace+"-reset":r.namespace,f=n(r.background||['<div class="'+u+"-loading "+u+'">','<div class="'+u+'-content">','<button class="'+u+"-close-icon "+r.namespace+'-close" aria-label="Close">',r.closeIcon,"<\/button>",'<div class="'+r.namespace+'-inner">'+r.loading+"<\/div>","<\/div>","<\/div>"].join("")),e="."+r.namespace+"-close"+(r.otherClose?","+r.otherClose:"");r.$instance=f.clone().addClass(r.variant);r.$instance.on(r.closeTrigger+"."+r.namespace,function(t){var i=n(t.target);("background"===r.closeOnClick&&i.is("."+r.namespace)||"anywhere"===r.closeOnClick||i.closest(e).length)&&(r.close(t),t.preventDefault())});return this},getContent:function(){var e,u;if(this.persist!==!1&&this.$content)return this.$content;var r=this,f=this.constructor.contentFilters,o=function(n){return r.$currentTarget&&r.$currentTarget.attr(n)},s=o(r.targetAttr),t=r.target||s||"",i=f[r.type];if(!i&&t in f&&(i=f[t],t=r.target&&s),t=t||o("href")||"",!i)for(e in f)r[e]&&(i=f[e],t=r[e]);return!i&&(u=t,t=null,n.each(r.contentFilters,function(){return i=f[this],i.test&&(t=i.test(u)),!t&&i.regex&&u.match&&u.match(i.regex)&&(t=u),!t}),!t)?("console"in window&&window.console.error("Featherlight: no content filter found "+(u?' for "'+u+'"':" (no target specified)")),!1):i.process.call(r,t)},setContent:function(t){var i=this;return t.is("iframe")&&i.$instance.addClass(i.namespace+"-iframe"),i.$instance.removeClass(i.namespace+"-loading"),i.$instance.find("."+i.namespace+"-inner").not(t).slice(1).remove().end().replaceWith(n.contains(i.$instance[0],t[0])?"":t),i.$content=t.addClass(i.namespace+"-inner"),i},open:function(t){var r=this,u;return(r.$instance.hide().appendTo(r.root),(!t||!t.isDefaultPrevented())&&r.beforeOpen(t)!==!1&&(t&&t.preventDefault(),u=r.getContent(),u))?(i.push(r),e(!0),r.$instance.fadeIn(r.openSpeed),r.beforeContent(t),n.when(u).always(function(n){r.setContent(n);r.afterContent(t)}).then(r.$instance.promise()).done(function(){r.afterOpen(t)})):(r.$instance.detach(),n.Deferred().reject().promise())},close:function(t){var i=this,u=n.Deferred();return i.beforeClose(t)===!1?u.reject():(0===r(i).length&&e(!1),i.$instance.fadeOut(i.closeSpeed,function(){i.$instance.detach();i.afterClose(t);u.resolve()})),u.promise()},resize:function(n,t){if(n&&t){this.$content.css("width","").css("height","");var i=Math.max(n/(parseInt(this.$content.parent().css("width"),10)-1),t/(parseInt(this.$content.parent().css("height"),10)-1));i>1&&(i=t/Math.floor(t/i),this.$content.css("width",""+n/i+"px").css("height",""+t/i+"px"))}},chainCallbacks:function(t){for(var i in t)this[i]=n.proxy(t[i],this,n.proxy(this[i],this))}};n.extend(t,{id:0,autoBind:"[data-featherlight]",defaults:t.prototype,contentFilters:{jquery:{regex:/^[#.]\w/,test:function(t){return t instanceof n&&t},process:function(t){return this.persist!==!1?n(t):n(t).clone(!0)}},image:{regex:/\.(png|jpg|jpeg|gif|tiff|bmp|svg)(\?\S*)?$/i,process:function(t){var f=this,u=n.Deferred(),i=new Image,r=n('<img src="'+t+'" alt="" class="'+f.namespace+'-image" />');return i.onload=function(){r.naturalWidth=i.width;r.naturalHeight=i.height;u.resolve(r)},i.onerror=function(){u.reject(r)},i.src=t,u.promise()}},html:{regex:/^\s*<[\w!][^<]*>/,process:function(t){return n(t)}},ajax:{regex:/./,process:function(t){var u=this,i=n.Deferred(),r=n("<div><\/div>").load(t,function(n,t){t!=="error"&&i.resolve(r.contents());i.fail()});return i.promise()}},iframe:{process:function(t){var i=new n.Deferred,r=n("<iframe/>"),f=s(this,"iframe"),e=o(f,u);return r.hide().attr("src",t).attr(e).css(f).on("load",function(){i.resolve(r.show())}).appendTo(this.$instance.find("."+this.namespace+"-content")),i.promise()}},text:{process:function(t){return n("<div>",{text:t})}}},functionAttributes:["beforeOpen","afterOpen","beforeContent","afterContent","beforeClose","afterClose"],readElementConfig:function(t,i){var u=this,f=new RegExp("^data-"+i+"-(.*)"),r={};return t&&t.attributes&&n.each(t.attributes,function(){var e=this.name.match(f),t,i;if(e){if(t=this.value,i=n.camelCase(e[1]),n.inArray(i,u.functionAttributes)>=0)t=new Function(t);else try{t=JSON.parse(t)}catch(o){}r[i]=t}}),r},extend:function(t,i){var r=function(){this.constructor=t};return r.prototype=this.prototype,t.prototype=new r,t.__super__=this.prototype,n.extend(t,this,i),t.defaults=t.prototype,t},attach:function(t,i,r){var u=this;typeof i!="object"||i instanceof n!=!1||r||(r=i,i=undefined);r=n.extend({},r);var s=r.namespace||u.defaults.namespace,f=n.extend({},u.defaults,u.readElementConfig(t[0],s),r),e,o=function(o){var h=n.extend({$source:t,$currentTarget:n(this)},u.readElementConfig(t[0],f.namespace),u.readElementConfig(this,f.namespace),r),s=e||n(this).data("featherlight-persisted")||new u(i,h);s.persist==="shared"?e=s:s.persist!==!1&&n(this).data("featherlight-persisted",s);h.$currentTarget.blur();s.open(o)};t.on(f.openTrigger+"."+f.namespace,f.filter,o);return o},current:function(){var n=this.opened();return n[n.length-1]||null},opened:function(){var t=this;return r(),n.grep(i,function(n){return n instanceof t})},close:function(n){var t=this.current();if(t)return t.close(n)},_onReady:function(){var t=this;if(t.autoBind){n(t.autoBind).each(function(){t.attach(n(this))});n(document).on("click",t.autoBind,function(i){if(!i.isDefaultPrevented()){var r=t.attach(n(i.currentTarget));r(i)}})}},_callbackChain:{onKeyUp:function(t,i){return 27===i.keyCode?(this.closeOnEsc&&n.featherlight.close(i),!1):t(i)},beforeOpen:function(t,i){return this._previouslyActive=document.activeElement,this._$previouslyTabbable=n("a, input, select, textarea, iframe, button, iframe, [contentEditable=true]").not("[tabindex]").not(this.$instance.find("button")),this._$previouslyWithTabIndex=n("[tabindex]").not('[tabindex="-1"]'),this._previousWithTabIndices=this._$previouslyWithTabIndex.map(function(t,i){return n(i).attr("tabindex")}),this._$previouslyWithTabIndex.add(this._$previouslyTabbable).attr("tabindex",-1),document.activeElement.blur(),t(i)},afterClose:function(t,i){var r=t(i),u=this;return this._$previouslyTabbable.removeAttr("tabindex"),this._$previouslyWithTabIndex.each(function(t,i){n(i).attr("tabindex",u._previousWithTabIndices[t])}),this._previouslyActive.focus(),r},onResize:function(n,t){return this.resize(this.$content.naturalWidth,this.$content.naturalHeight),n(t)},afterContent:function(n,t){var i=n(t);this.$instance.find("[autofocus]:not([disabled])").focus();this.onResize(t);return i}}});n.featherlight=t;n.fn.featherlight=function(n,i){return t.attach(this,n,i),this};n(document).ready(function(){t._onReady()})})(jQuery);